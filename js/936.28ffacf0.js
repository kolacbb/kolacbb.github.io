(self["webpackChunkAppLocalize"]=self["webpackChunkAppLocalize"]||[]).push([[936],{6241:function(e,t,s){var a,n,o;(function(s,r){n=[],a=r,o="function"===typeof a?a.apply(t,n):a,void 0===o||(e.exports=o)})(0,(function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function a(e,t,s){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){i(a.response,t,s)},a.onerror=function(){console.error("could not download file")},a.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(a){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof s.g&&s.g.global===s.g?s.g:void 0,l=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),i=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(e,t,s){var l=r.URL||r.webkitURL,i=document.createElement("a");t=t||e.name||"download",i.download=t,i.rel="noopener","string"==typeof e?(i.href=e,i.origin===location.origin?o(i):n(i.href)?a(e,t,s):o(i,i.target="_blank")):(i.href=l.createObjectURL(e),setTimeout((function(){l.revokeObjectURL(i.href)}),4e4),setTimeout((function(){o(i)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,s,r){if(s=s||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,r),s);else if(n(e))a(e,s,r);else{var l=document.createElement("a");l.href=e,l.target="_blank",setTimeout((function(){o(l)}))}}:function(e,t,s,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return a(e,t,s);var o="application/octet-stream"===e.type,i=/constructor/i.test(r.HTMLElement)||r.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||o&&i||l)&&"undefined"!=typeof FileReader){var h=new FileReader;h.onloadend=function(){var e=h.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},h.readAsDataURL(e)}else{var d=r.URL||r.webkitURL,g=d.createObjectURL(e);n?n.location=g:location.href=g,n=null,setTimeout((function(){d.revokeObjectURL(g)}),4e4)}});r.saveAs=i.saveAs=i,e.exports=i}))},4358:function(e,t,s){"use strict";s.d(t,{Z:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("canvas",{ref:"screenCanvas"},[e._v("Canvas not supported "+e._s(e.refreshCanvas(e.text)))])},n=[],o=(s(2801),s(1439),s(7585),s(5315),{props:["canvasWidth","canvasHeight","text","textAlign","backgroundColor","frameImgUrl","screenBlobImg"],data(){return{}},methods:{refreshCanvas(e){const t=this.canvasWidth,s=this.canvasHeight,a=this.$refs.screenCanvas;if(null==a)return;if(a.setAttribute("width",t+""),a.setAttribute("height",s+""),!a.getContext)return;const n=a.getContext("2d");n.fillStyle=this.backgroundColor,n.fillRect(0,0,t,s);const o={path:this.frameImgUrl,x:.05*t,y:.18*s,width:1564,height:3320,startX:59.4,startY:191.2,endX:1501.4,endY:3232.9,extraY:1548.8},r=.9*t/o.width;if(o.width=o.width*r,o.height=o.height*r,o.startX=o.x+o.startX*r,o.startY=o.y+o.startY*r,o.endX=o.x+o.endX*r,o.endY=o.y+o.endY*r,null!=this.text){const e=this.text.split("\n");if(n.beginPath(),n.fillStyle="#FFFFFF",0==this.textAlign){n.textAlign="left";let s=1<e.length?64:100;for(let a=0;a<e.length&&a<2;a++)n.font="bolder 74px Arial",n.fillText(e[a],o.x+12,100*(a+1)+s,t-2*o.x-12)}else if(2==this.textAlign){n.textAlign="right";let s=1<e.length?64:100;for(let a=0;a<e.length&&a<2;a++)n.font="bolder 74px Arial",n.fillText(e[a],t-o.x-12,100*(a+1)+s,t-2*o.x-12)}else{n.textAlign="center";let s=1<e.length?64:100;for(let a=0;a<e.length&&a<2;a++)n.font="bolder 74px Arial",n.fillText(e[a],t/2,100*(a+1)+s,t-2*o.x)}n.closePath()}var l=new Image;l.crossOrigin="Anonymous";const i=new FileReader;i.onload=function(e){l.src=e.target.result},i.readAsDataURL(this.screenBlobImg),l.src=this.screenBlobImg,l.onload=function(){const e=Math.max((o.endX-o.startX)/this.width,(o.endY-o.endX)/this.height);n.drawImage(this,o.startX,o.startY,this.width*e,this.height*e);let t=new Image;t.src=o.path,console.log("path path",o.path),t.onload=function(){n.drawImage(this,o.x,o.y,o.width,o.height)}}},exportImages(){const e=this.$refs.screenCanvas;var t=e.toDataURL("image/png"),s=this.dataURLtoBlob(t);let a=new File([s],(new Date).getTime()+".jpg");return a},dataURLtoBlob(e){var t=e.split(","),s=t[1].substring(0,t[1].length-2),a=t[0].match(/:(.*?);/)[1],n=atob(s),o=n.length,r=new Uint8Array(o);while(o--)r[o]=n.charCodeAt(o);return new Blob([r],{type:a})}},mounted(){this.refreshCanvas()},computed:{},watch:{canvasWidth(e,t){console.log("canvasWidth 变化:",e),this.refreshCanvas(this.text)},canvasHeight(e,t){console.log("canvasHeight 变化:",e),this.refreshCanvas(this.text)},text(e,t){console.log("text 变化:",e),this.refreshCanvas(this.text)},backgroundColor(e,t){console.log("backgroundColor 变化:",e),this.refreshCanvas(this.text)},frameImgUrl(e,t){console.log("frameImgUrl 变化:",e),this.refreshCanvas(this.text)},screenBlobImg(e,t){console.log("screenBlobImg 变化:",e),this.refreshCanvas(this.text)},textAlign(e,t){console.log("screenBlobImg 变化:",e),this.refreshCanvas(this.text)}}}),r=o,l=s(3736),i=(0,l.Z)(r,a,n,!1,null,null,null),c=i.exports},1936:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return I}});var a=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"container"},[t("div",{staticClass:"App"},[t("el-card",[t("div",{staticStyle:{display:"flex","justify-content":"end","align-items":"center"}},[t("el-select",{attrs:{filterable:""},model:{value:e.languagesSelected,callback:function(t){e.languagesSelected=t},expression:"languagesSelected"}},e._l(e.languagesOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-button",{attrs:{type:"primary"},on:{click:e.downloadShell}},[e._v("Download")]),t("el-button",{attrs:{loading:e.isUploadLoading,type:"primary"},on:{click:e.uploadGooglePlayAll}},[e._v("Upload to Google Play")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addDialogVisible=!0,e.isAddScreen=!0}}},[e._v("Add Screenshot")])],1),t("el-row",e._l(e.pageData,(function(s,a){return t("el-col",{key:a,attrs:{span:6}},[t("div",{staticClass:"drop-area",staticStyle:{border:"1px solid #e0e0e0","border-radius":"8px",margin:"8px",display:"flex","flex-direction":"column"}},[t("div",{staticStyle:{height:"40px","background-color":"white",display:"flex","justify-content":"space-between","align-items":"center"}},[t("div",[t("el-button",{staticStyle:{"margin-left":"16px","font-weight":"bold"},attrs:{type:"text"},on:{click:function(t){return e.handleSwap(e.pageData[a-1],s)}}},[e._v(e._s("<"))]),t("el-button",{staticStyle:{"font-weight":"bold"},attrs:{type:"text"},on:{click:function(t){return e.handleSwap(s,e.pageData[a+1])}}},[e._v(e._s(">"))])],1),t("el-button",{staticStyle:{margin:"16px","font-weight":"bold"},attrs:{type:"text"},on:{click:function(t){e.addDialogVisible=!0,e.isAddScreen=!1,e.screenshotFrom=s}}},[e._v("Edit ")])],1),t("screen-canvas",{key:a,attrs:{"canvas-width":"1080","canvas-height":"1920",text:e.getLanguageParam(s,"EN"),"background-color":s.ssBgColor,"frame-img-url":"/frames/google-pixel-4-xl-black.png","screen-url":s.ssAppUrl}})],1)])})),1),e._l(e.languagesOptions,(function(s){return t("div",[t("span",{staticStyle:{margin:"12px"}},[e._v(e._s(s.label))]),t("el-row",e._l(e.pageData,(function(a,n){return t("el-col",{key:n,attrs:{span:6}},[t("div",{staticClass:"drop-area",staticStyle:{border:"1px solid #e0e0e0","border-radius":"8px",margin:"8px",display:"flex","flex-direction":"column"}},[t("screen-canvas",{ref:"screenRefs_"+s.value,refInFor:!0,attrs:{"canvas-width":"1080","canvas-height":"1920",text:e.getLanguageParam(a,s.value),"background-color":a.ssBgColor,"frame-img-url":"/frames/google-pixel-4-xl-black.png","screen-url":a.ssAppUrl}})],1)])})),1)],1)}))],2)],1),t("el-dialog",{attrs:{title:this.isAddScreen?"Edit Screenshot":"Add Screenshot",visible:e.addDialogVisible,width:"30%"},on:{"update:visible":function(t){e.addDialogVisible=t}}},[t("el-form",{ref:"screenshotFrom",attrs:{model:e.screenshotFrom}},[t("el-form-item",{attrs:{label:"String ID",prop:"screenshot"}},[t("el-input",{model:{value:e.screenshotFrom.transId,callback:function(t){e.$set(e.screenshotFrom,"transId",t)},expression:"screenshotFrom.transId"}})],1),t("el-form-item",{attrs:{label:"Screenshot Url",prop:"screenshot"}},[t("el-input",{model:{value:e.screenshotFrom.ssAppUrl,callback:function(t){e.$set(e.screenshotFrom,"ssAppUrl",t)},expression:"screenshotFrom.ssAppUrl"}})],1),t("el-form-item",{attrs:{label:"Background Color(eg: #0000000)",prop:"screenshot"}},[t("el-input",{model:{value:e.screenshotFrom.ssBgColor,callback:function(t){e.$set(e.screenshotFrom,"ssBgColor",t)},expression:"screenshotFrom.ssBgColor"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("Cancel")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handAddScreenshot}},[e._v(e._s(e.isAddScreen?"Add":"Update"))])],1)],1)],1)},n=[],o=(s(7658),s(6693)),r=function(){var e=this,t=e._self._c;return t("canvas",{ref:"screenCanvas"},[e._v("Canvas not supported "+e._s(e.refreshCanvas(e.text)))])},l=[],i=(s(2801),s(1439),s(7585),s(5315),{props:["canvasWidth","canvasHeight","text","backgroundColor","frameImgUrl","screenUrl"],data(){return{}},methods:{refreshCanvas(e){const t=this.canvasWidth,s=this.canvasHeight,a=this.$refs.screenCanvas;if(null==a)return;if(a.setAttribute("width",t+""),a.setAttribute("height",s+""),!a.getContext)return;const n=a.getContext("2d");n.fillStyle=this.backgroundColor,n.fillRect(0,0,t,s);const o={path:this.frameImgUrl,x:.05*t,y:.18*s,width:1564,height:3320,startX:59.4,startY:191.2,endX:1501.4,endY:3232.9,extraY:1548.8},r=.9*t/o.width;o.width=o.width*r,o.height=o.height*r,o.startX=o.x+o.startX*r,o.startY=o.y+o.startY*r,o.endX=o.x+o.endX*r,o.endY=o.y+o.endY*r,null==this.text&&(this.text="");let l=this.text.split("\\n");l.length<=1&&(l=this.text.split("\n")),n.beginPath(),n.fillStyle="#FFFFFF",n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.textAlign="center";let i=64;for(let h=0;h<l.length&&h<2;h++)n.font="bolder 74px Arial",n.fillText(l[h],t/2,100*(h+1)+i,t-o.x);n.closePath();var c=new Image;c.crossOrigin="Anonymous",c.src=this.screenUrl,c.onload=function(){const e=Math.max((o.endX-o.startX)/this.width,(o.endY-o.endX)/this.height);n.drawImage(this,o.startX,o.startY,this.width*e,this.height*e);let t=new Image;t.src=o.path,t.onload=function(){n.drawImage(this,o.x,o.y,o.width,o.height)}}},exportImages(){const e=this.$refs.screenCanvas;var t=e.toDataURL("image/png",.9),s=this.dataURLtoBlob(t);let a=new File([s],(new Date).getTime()+".jpg");return a},dataURLtoBlob(e){var t=e.split(","),s=t[1].substring(0,t[1].length-2),a=t[0].match(/:(.*?);/)[1],n=atob(s),o=n.length,r=new Uint8Array(o);while(o--)r[o]=n.charCodeAt(o);return new Blob([r],{type:a})}},mounted(){this.refreshCanvas()},watch:{canvasWidth(e,t){console.log("canvasWidth 变化:",e),this.refreshCanvas(this.text)},canvasHeight(e,t){console.log("canvasHeight 变化:",e),this.refreshCanvas(this.text)},text(e,t){console.log("text 变化:",e),this.refreshCanvas(this.text)},backgroundColor(e,t){console.log("backgroundColor 变化:",e),this.refreshCanvas(this.text)},frameImgUrl(e,t){console.log("frameImgUrl 变化:",e),this.refreshCanvas(this.text)},screenUrl(e,t){console.log("screenBlobImg 变化:",e),this.refreshCanvas(this.text)}}}),c=i,h=s(3736),d=(0,h.Z)(c,r,l,!1,null,null,null),g=d.exports,u=s(3329);const p=e=>u.Z.post("/screenshots/get",e),f=e=>u.Z.post("/screenshots/insert",e),m=e=>u.Z.post("/screenshots/update",e),v=e=>{let t={headers:{"Content-Type":"multipart/form-data"}};return u.Z.postForm("/screenshots/upload",e,t)};var b=s(6241),x=s.n(b),w=s(4358),y={components:{ScreenPreview:w.Z,ScreenCanvas:g},data(){return{isAddScreen:!0,isLoading:!1,addDialogVisible:!1,isUploadLoading:!1,languagesOptions:[],languagesSelected:"EN",pageData:[],screenshotFrom:{projectId:this.$route.params.id,transId:0,ssAppUrl:"",ssBgColor:""}}},computed:{},watch:{projectData(e,t){this.$route.params.id==this.$store.state.tab.projectData.projectId&&this.refreshPage()},languagesSelected(e,t){e!=t&&(this.pageData=this.pageData)}},mounted(){this.refreshPage()},methods:{refreshPage(){const e=this.$store.state.tab.projectData;if(this.$route.params.id!=e.projectId)return;const t=[];e.languages.split(",").forEach((e=>{console.log(e),t.push(e.trim())})),this.languagesOptions=[],Object.keys(o.Z.state.allLanguages).forEach((e=>{t.includes(o.Z.state.languageKey[e])&&this.languagesOptions.push({label:o.Z.state.allLanguages[e],value:o.Z.state.languageKey[e]})}));const s={projectId:this.$route.params.id};p(s).then((e=>{this.isLoading=!1,console.log(e),this.pageData=e.data}))},getLanguageParam(e,t){let s="";return console.log(t),Object.keys(o.Z.state.languageKey).forEach((a=>{t===o.Z.state.languageKey[a]&&(s=e.transKeys[a])})),s},getLanguageName(){return o.Z.state.languages[this.languagesSelected]},handleSwap(e,t){if(null==e||null==t)return;let s=e.ssId;e.ssId=t.ssId,t.ssId=s,console.log(e.ssId,t.ssId),m(e).then((s=>{console.log(s),m(t).then((s=>{console.log(s);let a={};a.transId=e.transId,a.ssAppUrl=e.ssAppUrl,a.ssBgColor=e.ssBgColor,e.transId=t.transId,e.ssAppUrl=t.ssAppUrl,e.ssBgColor=t.ssBgColor,t.transId=a.transId,t.ssAppUrl=a.ssAppUrl,t.ssBgColor=a.ssBgColor}))}))},handAddScreenshot(){this.isAddScreen?f(this.screenshotFrom).then((e=>{console.log(e),this.addDialogVisible=!1})):m(this.screenshotFrom).then((e=>{console.log(e),this.addDialogVisible=!1}))},uploadGooglePlayAll(){const e=this.$store.state.tab.projectData,t=[];e.languages.split(",").forEach((e=>{t.push(e.trim())})),console.log(t),this.uploadGooglePlay(t,0)},uploadGooglePlay(e,t){let s=e[t];this.isUploadLoading=!0;let a=new Array(this.$refs["screenRefs_"+s].length);for(let o=0;o<this.$refs["screenRefs_"+s].length;o++)a[o]=this.$refs["screenRefs_"+s][o].exportImages();let n=new FormData;Array.from(a).forEach((e=>{n.append("files",e),console.log(e)})),n.append("projectId",this.$route.params.id),n.append("languages",s),v(n).then((s=>{this.isUploadLoading=!1,console.log(s),t<e.length-1&&this.uploadGooglePlay(e,t+1)}))},formatImageUrl(e){return this.require("/assets/logo.png")},downloadShell(){var e="#!/bin/bash\n";e+="adb devices";const t=new Blob([e],{type:"text/plain;charset=utf-8"});x().saveAs(t,"applocalize_gen_screenshot.bat")}}},A=y,C=(0,h.Z)(A,a,n,!1,null,"08c90cd0",null),I=C.exports}}]);
//# sourceMappingURL=936.28ffacf0.js.map